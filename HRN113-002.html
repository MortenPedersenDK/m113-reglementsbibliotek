<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <title>HRN 113-002 - PMV M113 G3/G4 DK</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="favicon-16x16.svg">
    <link rel="alternate icon" href="favicon.ico">
    <link rel="stylesheet" href="css/manual-styles.css">
</head>
<body>
    <div class="container">
        <!-- Navigation overlay for mobile -->
        <div class="nav-overlay" id="navOverlay"></div>
        
        <!-- Main content -->
        <div class="main-content" id="mainContent">
            <div class="toolbar">
                <button class="menu-btn" id="menuBtn">☰</button>
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Søg i reglement..." 
                           autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                    <button class="clear-search-btn" id="clearSearchBtn" style="display: none;">×</button>
                    <div class="search-results-dropdown" id="searchResults" style="display: none;">
                        <!-- Search results will be populated here -->
                    </div>
                </div>
                <div class="nav-controls">
                    <button class="nav-btn" id="prevBtn" disabled>‹</button>
                    <button class="nav-btn" id="nextBtn" disabled>›</button>
                    <button class="offline-btn" id="offlineBtn" data-manual-id="HRN113-002">⬇ Offline</button>
                </div>
            </div>
            
            <!-- Navigation dropdown -->
            <div class="nav-dropdown" id="navDropdown" style="display: none;">
                <div class="nav-dropdown-header">
                    <div class="nav-dropdown-title">HRN 113-002 Manual</div>
                </div>
                <div class="toc-container" id="tocContainer">
                    <!-- Table of contents will be populated here -->
                </div>
            </div>
            
            <div class="page-info-bar">
                <div class="page-info" id="pageInfo">Vælg en side fra menuen</div>
            </div>
            
            <div class="content-area" id="contentArea" tabindex="0">
                <div class="welcome-message">
                    <div class="welcome-title">HRN 113-002</div>
                    <p class="subtitle-large">PMV M113 G3/G4 DK - Pansret mandskabsvogn</p>
                    <p style="padding-top: 20px;"><em>Vælg et kapitel eller afsnit fra menuen, eller søg på specifikke ord for at begynde</em></p>
                    <div class="usage-instructions-inline">
                        <h4>Sådan navigeres i reglementet:</h4>
                        <p><strong>Navigation gennem sider:</strong></p>
                        <ul>
                            <li><strong>Tastatur:</strong> Brug piletasterne (← →) til at bladre frem og tilbage mellem sider</li>
                            <li><strong>Mus:</strong> Klik på pilene (‹ ›) i værktøjslinjen eller brug musehjulet når en side er åben</li>
                            <li><strong>Touch/tablet:</strong> Swipe til venstre eller højre på siden for at skifte sider</li>
                            <li><strong>Zoom på mobil:</strong> Brug knib-gestus (pinch) til at zoome ind på detaljer i dokumentet</li>
                        </ul>
                        <p><strong>Søgning:</strong> Brug søgefeltet til at finde specifikke ord eller udtryk i reglementet. Søgeresultater viser kontekst og leder direkte til den relevante side.</p>
                        <p><strong>Indholdsfortegnelse:</strong> Klik på menu-knappen (☰) for at åbne indholdsfortegnelsen og navigere direkte til ønskede kapitler og afsnit.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Status Indicator -->
    <div class="connection-status">
        <span id="connection-status" class="status-online">Online</span>
        <a href="#" id="reload-link" class="reload-link" onclick="if(window.offlineManager) window.offlineManager.performUpdate(); return false;">Genindlæs</a>
    </div>

    <!-- Debug Panel for iPad -->
    <div id="debug-panel" style="position: fixed; bottom: 40px; left: 10px; background: rgba(0,0,0,0.9); color: white; padding: 10px; border-radius: 5px; font-size: 11px; max-width: 300px; max-height: 200px; overflow-y: auto; z-index: 9999; font-family: monospace; display: none;">
        <div style="font-weight: bold; margin-bottom: 5px;">Debug Info <button onclick="document.getElementById('debug-panel').style.display='none'" style="float: right; background: none; border: none; color: white;">×</button></div>
        <div id="debug-log"></div>
    </div>
    
    <!-- Debug Toggle Button -->
    <button id="debug-toggle" onclick="toggleDebugPanel()" style="position: fixed; bottom: 100px; left: 10px; background: rgba(0,0,0,0.7); color: white; border: 1px solid #ccc; padding: 5px 8px; border-radius: 3px; font-size: 10px; z-index: 9998;">Debug</button>

    <script>
        // Debug panel functions
        function toggleDebugPanel() {
            const panel = document.getElementById('debug-panel');
            const isVisible = panel.style.display !== 'none';
            panel.style.display = isVisible ? 'none' : 'block';
        }
        
        function addDebugLog(message) {
            const log = document.getElementById('debug-log');
            if (log) {
                const timestamp = new Date().toLocaleTimeString();
                const entry = document.createElement('div');
                entry.innerHTML = `<span style="color: #888;">[${timestamp}]</span> ${message}`;
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
                
                // Keep only last 20 entries
                while (log.children.length > 20) {
                    log.removeChild(log.firstChild);
                }
            }
        }
        
        // Global debug function
        window.debugLog = addDebugLog;
        
        // Log page load
        document.addEventListener('DOMContentLoaded', function() {
            addDebugLog('HRN113-002 page loaded at ' + new Date().toLocaleString());
        });
    </script>
    
    <script>
        // Configuration for this manual
        window.MANUAL_CONFIG = {
            searchIndexUrl: 'data/HRN113-002-search-index.json',
            tocUrl: 'data/HRN113-002-toc.json',
            manualId: 'HRN113-002',
            title: 'HRN 113-002 - PMV M113 G3 DK'
        };
    </script>
    
    <script>
        // Track script loading
        window.addEventListener('error', function(e) {
            if (window.debugLog) {
                window.debugLog('Script error: ' + e.filename + ' - ' + e.message);
            }
        });
        
        // Test before loading offline-manager.js
        if (window.debugLog) {
            window.debugLog('About to load offline-manager.js');
        }
    </script>
    
    <script src="js/offline-manager.js" onload="if(window.debugLog) window.debugLog('offline-manager.js loaded successfully')" onerror="if(window.debugLog) window.debugLog('ERROR: offline-manager.js failed to load')"></script>
    <script>
        // Check if OfflineManager class is available after script load
        setTimeout(function() {
            if (window.debugLog) {
                window.debugLog('OfflineManager class exists: ' + (typeof OfflineManager !== 'undefined'));
                window.debugLog('window.offlineManager exists: ' + (typeof window.offlineManager !== 'undefined'));
            }
        }, 100);
    </script>
    <script src="js/app.js" onload="if(window.debugLog) window.debugLog('app.js loaded successfully')" onerror="if(window.debugLog) window.debugLog('ERROR: app.js failed to load')"></script>
</body>
</html>
